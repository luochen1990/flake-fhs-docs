---
title: 最佳实践
---

以下是使用 Flake FHS 的推荐实践，遵循这些原则可以帮助你构建更易维护、性能更好的项目。

## 项目组织

*   **遵循约定**
    尽量使用框架默认的目录结构，减少自定义配置。约定优于配置（Convention over Configuration）是 Flake FHS 的核心理念。

*   **模块化**
    将复杂的系统配置拆分为小的、可复用的模块 (`modules/`)。避免在一个巨大的 `configuration.nix` 中堆砌所有配置。

*   **利用封装**
    如果一个包需要多个辅助文件，请使用目录模式（即创建 `pkgs/<name>/package.nix`）。该目录下的其他 `.nix` 文件（如 `helper.nix`）不会被自动扫描为独立包，从而保持对外接口的整洁。

## 开发流程

*   **快速开始**
    总是使用模板 (`nix flake init --template ...`) 来初始化新项目或组件，这能确保你获得正确的样板代码。

*   **持续检查**
    养成运行 `nix flake check` 的习惯，配合 `checks/` 目录下的测试用例。这能尽早发现构建错误。

*   **格式化**
    使用 `nix fmt` 保持代码风格统一。一致的代码风格有助于多人协作。

## 性能优化

*   **模块化管理**
    对于拥有大量 NixOS 模块的项目，Flake FHS 的模块加载机制（Guarded Modules）可以帮助你更好地组织代码。
    
    **建议**：确保将独立的模块放入带有 `options.nix` 的子目录中。这样，该模块的配置逻辑只有在显式设置 `enable = true` 时才会加载，从而显著减少 Nix 评估时的开销。
